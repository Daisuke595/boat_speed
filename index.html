<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<script>
let intervalId = null; // タイマーIDを格納する変数

// 位置情報を取得する関数
function getLocation() {
    navigator.geolocation.getCurrentPosition(displayLocation);
}

// 位置情報を表示する関数
function displayLocation(position) {

    // 各データを個別にコンソールに出力
    console.log("緯度:", position.coords.latitude);
    console.log("経度:", position.coords.longitude);
    console.log("高度:", position.coords.altitude);
    console.log("位置精度:", position.coords.accuracy);
    console.log("高度精度:", position.coords.altitudeAccuracy);
    console.log("移動方向:", position.coords.heading);
    console.log("速度:", position.coords.speed);

    // 現在時刻を取得
    const currentTimestamp = Date.now(); // 現在のタイムスタンプを取得
    const currentDate = new Date(currentTimestamp);
    // Safari互換性のためにスラッシュ区切り形式に変換
    const dateStr = currentDate.toISOString().slice(0, 19).replace("T", " ");
    const fixedDateStr = dateStr.replace(/-/g, '/');
    // 日本語ロケールでフォーマット
    // 日本標準時（JST）でフォーマット
    const formattedDate = currentDate.toLocaleString('ja-JP', {
        timeZone: 'Asia/Tokyo', // タイムゾーンを明確に指定
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
    });
    console.log("取得時刻:", formattedDate);



    // 位置情報を取得して文字列を生成
    const geo_text = `
        緯度: ${position.coords.latitude}, 
        経度: ${position.coords.longitude}, 
        高度: ${position.coords.altitude}, 
        位置精度: ${position.coords.accuracy}, 
        高度精度: ${position.coords.altitudeAccuracy}, 
        移動方向: ${position.coords.heading}, 
        速度: ${position.coords.speed}, 
        取得時刻: ${formattedDate}
    `;

    // ページ上に表示
    const dataList = document.getElementById("dataList");
    const listItem = document.createElement("li");
    listItem.textContent = geo_text;
    dataList.appendChild(listItem); // 新しいデータをリストに追加
}

// 設定時刻ごとに位置情報を取得する関数
function startTracking() {
    // 既存のタイマーがあればクリア
    if (intervalId !== null) {
        clearInterval(intervalId);
        intervalId = null;
    }

    // 選択された間隔を取得
    const interval = document.querySelector('input[name="interval"]:checked').value;

    // 指定された間隔（ミリ秒）ごとに位置情報を取得
    intervalId = setInterval(getLocation, parseInt(interval));
}

// トラッキングを停止する関数
function stopTracking() {
    if (intervalId !== null) {
        clearInterval(intervalId);
        intervalId = null;
        alert("位置情報の取得を停止しました。");
    }
}

function formatDateForSafari(positionTimestamp) {
    // タイムスタンプを文字列形式の日付に変換
    const dateStr = new Date(positionTimestamp).toISOString().slice(0, 19).replace("T", " ");
    // Safari互換性のためにハイフンをスラッシュに変換
    const fixedDateStr = dateStr.replace(/-/g, '/');
    // 日本語ロケールで日時をフォーマット
    const formattedDate = new Date(fixedDateStr).toLocaleString('ja-JP');
    return formattedDate;
}

</script>
</head>
<body>

<h1>位置情報取得プログラム</h1>

<!-- ラジオボタンで間隔を選択 -->
<p>位置情報の取得間隔を選択してください:</p>
<label><input type="radio" name="interval" value="10000" checked> 10秒</label><br>
<label><input type="radio" name="interval" value="15000"> 15秒</label><br>
<label><input type="radio" name="interval" value="20000"> 20秒</label><br>

<!-- ボタンで開始・停止 -->
<button onclick="startTracking()">開始</button>
<button onclick="stopTracking()">停止</button>

<!-- データ表示エリア -->
<h2>取得した位置情報:</h2>
<ul id="dataList"></ul>

</body>
</html>
